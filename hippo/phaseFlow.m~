function phaseFlow(phi)

sz = [8 8];
[xs ys] = meshgrid(1:sz(1),1:sz(2));
grid = [xs(:); ys(:)] + .5;
per = 2/1250;
phiT = squeeze(phi(:,1,:));
vals = 1./(per*(2:2:60));
wav = 'cmor10-1';
f = scal2frq(vals,wav,per);
t = zeros(size(phiT,1),numel(vals),size(phiT,2));
for i = 1:size(phiT,1)
    t(i,:,:) = cwt(phiT(i,:),vals,wav);
%    subplot(8,8,i);imagesc(complexIm(t(i,:,:),0,1));
end
figure;plot(squeeze(mean(abs(t),3))');
c= colormap(hsv(size(phi,3)));
f1 = figure;f2 = figure;f3 = figure;
scale = 5;
for i = 1:numel(vals)
    tt = squeeze(t(:,i,:));
    [u,~,v] = svds(tt,1);
    va = angle(mean(conj(u))*v);
    tt = bsxfun(@times,tt,exp(1i*va).');
    figure(f1);subplot(5,6,i);imagesc(complexIm(tt,0,1));
    figure(f2);subplot(5,6,i);imagesc(complexIm(reshape(u*exp(1i*angle(mean(conj(u)))),[8 8]),0,1,30/f(i)));
    figure(f3);subplot(5,6,i);
    for j = 1:size(phi,3)
        [dx dy] = circ_diff(reshape(tt(:,j),sz));
        dx = dx/f(i)*
        hold all;
        scatter(scale(1)*dx(:)+xs(:),scale(end)*dy(:) + ys(:),5,c(j,:),'filled');
    end
    set(gca,'xlim',[0 9],'ylim',[0 9]);
end

function [dx dy] = circ_diff(in)
dx = ones(size(in));dy = ones(size(in));
dx(:,2:end) = in(:,2:end)./in(:,1:end-1);
dx(:,1:end-1) = dx(:,1:end-1).*dx(:,2:end);
dx = angle(dx);
dy(2:end,:) = angle(in(2:end,:)./in(1:end-1,:));
dy(1:end-1,:) = dy(1:end-1,:).*dy(2:end,:);
dy = angle(dy);